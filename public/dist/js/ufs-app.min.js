/*!
 * Mowe {ProjectName} Project v0.0.0 (http://letsmowe.org/)
 * Copyright 2013-2015 Mowe Developers
 * Licensed under MIT (https://github.com/mowekabanas/base/blob/master/LICENSE)
*/
var App=function(){function t(t,e){var n=this;this.element=t,this.base=e,this.votingBox=new VotingBox(document.getElementById("voting-box"),this.base),this.header=document.getElementById("ufs-app-header"),this.fullscreenCtrl=function(){n.requestFullScreen()},this.isFullscreen=!1,this.init()}return t.prototype.requestFullScreen=function(){this.isFullscreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),this.isFullscreen=!this.isFullscreen},t.prototype.init=function(){this.header.addEventListener("click",this.fullscreenCtrl)},t}(),Candidate=function(){function t(t,e,n){var i=this;this.element=t,this.candidateRef=e,this.voteButton=n,this.key=!1,this.onCandidateChange=function(t){var e=t.val();e&&(i.name=e.name,i.photoURL=e.photoURL,i.build(e))},this.element&&this.candidateRef&&this.init()}return t.prototype.build=function(t){try{this.element.innerHTML="",this.element.className="Candidate",this.background=document.createElement("div"),this.background.className="Candidate-background",this.element.appendChild(this.background),this.background.style.backgroundImage="url("+this.photoURL+")",this.overlay=document.createElement("div"),this.overlay.className="Candidate-overlay",this.background.appendChild(this.overlay),this.inner=document.createElement("div"),this.inner.className="Candidate-inner",this.element.appendChild(this.inner),this.voteButton.build(this),this.inner.appendChild(this.voteButton.element)}catch(e){}},t.prototype.destroy=function(){try{this.element.innerHeight="",self.candidateRef.off()}catch(t){}},t.prototype.ctrlDataRefs=function(){try{this.candidateRef.on("value",this.onCandidateChange)}catch(t){}},t.prototype.init=function(){this.ctrlDataRefs()},t}(),Match=function(){function t(t,e){var n=this;this.element=t,this.matchRef=e,this.key=!1,this.candidates=[],this.onMatchValueChange=function(t){n.key||(n.key=t.key);var e=t.val();e&&n.build(e)},this.element&&this.matchRef&&this.init()}return t.prototype.build=function(t){try{this.element.innerHTML="",this.destroyAllCandidates();for(var e=Object.keys(t.candidates),n=0;n<e.length;n++){var i=document.createElement("div"),s=firebase.database().ref("candidates/"+e[n]),a=new VoteButton(this.key,e[n]),o=new Candidate(i,s,a);e.push(o),this.element.appendChild(o.element)}}catch(c){}},t.prototype.destroyAllCandidates=function(){for(var t=this.candidates.length;t--;)this.candidates[t].destroy();this.candidates=[]},t.prototype.destroy=function(){console.log("destruindo match");try{this.destroyAllCandidates(),this.element.innerHTML="",this.matchRef.off()}catch(t){}},t.prototype.ctrlDataRefs=function(){try{this.matchRef.on("value",this.onMatchValueChange)}catch(t){}},t.prototype.init=function(){this.ctrlDataRefs()},t}(),Vote=function(){function t(t,e){this.match=t,this.candidate=e,this.timestamp=Date.now(),this.userAgent=window.navigator.userAgent,this.key=null}return t.prototype.send=function(){try{this.key=votesRef.push(this).key,console.log(this.key)}catch(t){}},t}(),VotingBox=function(){function t(t,e){var n=this;this.element=t,this.base=e,this.current=!1,this.match=!1,this.onCurrentValueChange=function(t){var e=t.val();e&&(n.current=e,n.match&&n.match.destroy(),n.match=new Match(document.getElementById("match"),n.rootRef.ref("matches").child(e)))},this.element&&this.base&&this.init()}return t.prototype.ctrlDataRefs=function(){this.rootRef=this.base.database(),this.currentRef=this.rootRef.ref("current"),this.currentRef.on("value",this.onCurrentValueChange)},t.prototype.init=function(){this.ctrlDataRefs()},t}();