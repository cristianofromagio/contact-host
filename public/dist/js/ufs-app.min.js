/*!
 * Mowe {ProjectName} Project v0.0.0 (http://letsmowe.org/)
 * Copyright 2013-2015 Mowe Developers
 * Licensed under MIT (https://github.com/mowekabanas/base/blob/master/LICENSE)
*/
var App=function(){function t(t,e){var n=this;this.element=t,this.base=e,this.votingBox=new VotingBox(document.getElementById("voting-box"),this.base),this.header=document.getElementById("ufs-app-header"),this.fullscreenCtrl=function(){n.requestFullScreen()},this.isFullscreen=!1,this.init()}return t.prototype.requestFullScreen=function(){this.isFullscreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),this.isFullscreen=!this.isFullscreen},t.prototype.init=function(){this.header.addEventListener("click",this.fullscreenCtrl)},t}(),Candidate=function(){function t(t,e,n){var i=this;this.element=t,this.candidateRef=e,this.voteButton=n,this.key=!1,this.onCandidateChange=function(t){var e=t.val();e&&(i.name=e.name,i.photoURL=e.photoURL,i.build(e))},this.element&&this.candidateRef&&this.init()}return t.prototype.build=function(t){try{this.element.innerHTML="",this.element.className="Candidate",this.background=document.createElement("div"),this.background.className="Candidate-background",this.element.appendChild(this.background),this.overlay=document.createElement("div"),this.overlay.className="Candidate-overlay",this.background.appendChild(this.overlay),this.title=document.createElement("div"),this.title.className="Candidate-title",this.titleSpan=document.createElement("span"),this.titleSpan.innerText=this.name,this.title.appendChild(this.titleSpan),this.background.appendChild(this.title),this.image=document.createElement("div"),this.image.className="Candidate-image",this.background.appendChild(this.image),this.image.style.backgroundImage="url("+this.photoURL+")",this.inner=document.createElement("div"),this.inner.className="Candidate-inner",this.element.appendChild(this.inner),this.voteButton.build(this),this.inner.appendChild(this.voteButton.element)}catch(e){}},t.prototype.destroy=function(){try{this.element.innerHeight="",self.candidateRef.off()}catch(t){}},t.prototype.ctrlDataRefs=function(){try{this.candidateRef.on("value",this.onCandidateChange)}catch(t){}},t.prototype.init=function(){this.ctrlDataRefs()},t}(),Match=function(){function t(t,e){var n=this;this.element=t,this.matchRef=e,this.key=!1,this.candidates=[],this.onMatchValueChange=function(t){n.key||(n.key=t.key);var e=t.val();e&&n.build(e)},this.element&&this.matchRef&&this.init()}return t.prototype.build=function(t){try{this.element.innerHTML="",this.destroyAllCandidates();for(var e=Object.keys(t.candidates),n=0;n<e.length;n++){var i=document.createElement("div"),s=firebase.database().ref("candidates/"+e[n]),a=new VoteButton(this.key,e[n]),o=new Candidate(i,s,a);o.classList="left",e.push(o),this.element.appendChild(o.element)}}catch(r){}},t.prototype.destroyAllCandidates=function(){for(var t=this.candidates.length;t--;)this.candidates[t].destroy();this.candidates=[]},t.prototype.destroy=function(){try{this.destroyAllCandidates(),this.element.innerHTML="",this.matchRef.off()}catch(t){}},t.prototype.ctrlDataRefs=function(){try{this.matchRef.on("value",this.onMatchValueChange)}catch(t){}},t.prototype.init=function(){this.ctrlDataRefs()},t}(),Modal=function(){function t(t){this.element=t,this.isShown=!1,this.element&&this.init()}return t.prototype.toggle=function(){this.isShown?this.hide():this.show()},t.prototype.show=function(){var t=this;this.isShown=!0,this.element.classList.add("is-active"),setTimeout(function(){t.element.classList.add("is-shown")},50)},t.prototype.hide=function(){var t=this;this.isShown=!1,this.element.classList.remove("is-shown"),setTimeout(function(){t.element.classList.remove("is-active")},600)},t.prototype.init=function(){this.element.classList.contains("is-active")&&(this.isShown=!0)},t}(),VoteButton=function(){function t(t,e){var n=this;this.matchKey=t,this.candidateKey=e,this.vote=function(t){n.delay&&clearTimeout(n.delay),modal.show(),n.delay=setTimeout(function(){var t=new Vote(n.matchKey,n.candidateKey);t.send(),setTimeout(function(){modal.hide()},2e3)},1e3)},this.onClick=function(){n.vote()},this.onTouchStart=function(){n.vote();try{window.navigator.vibrate(200),n.doBeep()}catch(t){}},this.init()}return t.prototype.delay=!1,t.prototype.audio=new Audio("../audio/music_marimba_chord.wav"),t.prototype.doBeep=function(){this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.audio.play())},t.prototype.build=function(t){this.element.innerHTML="",this.element.className="Button",this.pill=document.createElement("span"),this.pill.className="Button-pill",this.element.appendChild(this.pill),this.pillSpan=document.createElement("span"),this.pillSpan.innerText="Votar!",this.pill.appendChild(this.pillSpan),this.label=document.createElement("span"),this.label.className="Button-label",this.element.appendChild(this.label),this.labelSpan=document.createElement("span"),this.labelSpan.innerText=t.name,this.label.appendChild(this.labelSpan)},t.prototype.init=function(){this.element=document.createElement("button");try{this.element.addEventListener("click",this.onClick,!1),this.element.addEventListener("touchstart",this.onTouchStart,!1)}catch(t){}},t}(),Vote=function(){function t(t,n){this.match=t,this.candidate=n,this.timestamp=Date.now(),this.userAgent=window.navigator.userAgent,this.hash=e(this.userAgent),console.log(this),this.key=null}var e=function(t){function e(t,e){return t<<e|t>>>32-e}function n(t,e){var n,i,s,a,o;return s=2147483648&t,a=2147483648&e,n=1073741824&t,i=1073741824&e,o=(1073741823&t)+(1073741823&e),n&i?2147483648^o^s^a:n|i?1073741824&o?3221225472^o^s^a:1073741824^o^s^a:o^s^a}function i(t,e,n){return t&e|~t&n}function s(t,e,n){return t&n|e&~n}function a(t,e,n){return t^e^n}function o(t,e,n){return e^(t|~n)}function r(t,s,a,o,r,h,c){return t=n(t,n(n(i(s,a,o),r),c)),n(e(t,h),s)}function h(t,i,a,o,r,h,c){return t=n(t,n(n(s(i,a,o),r),c)),n(e(t,h),i)}function c(t,i,s,o,r,h,c){return t=n(t,n(n(a(i,s,o),r),c)),n(e(t,h),i)}function l(t,i,s,a,r,h,c){return t=n(t,n(n(o(i,s,a),r),c)),n(e(t,h),i)}function u(t){for(var e,n=t.length,i=n+8,s=(i-i%64)/64,a=16*(s+1),o=Array(a-1),r=0,h=0;h<n;)e=(h-h%4)/4,r=h%4*8,o[e]=o[e]|t.charCodeAt(h)<<r,h++;return e=(h-h%4)/4,r=h%4*8,o[e]=o[e]|128<<r,o[a-2]=n<<3,o[a-1]=n>>>29,o}function d(t){var e,n,i="",s="";for(n=0;n<=3;n++)e=t>>>8*n&255,s="0"+e.toString(16),i+=s.substr(s.length-2,2);return i}function m(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e+=String.fromCharCode(i):i>127&&i<2048?(e+=String.fromCharCode(i>>6|192),e+=String.fromCharCode(63&i|128)):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128),e+=String.fromCharCode(63&i|128))}return e}var p,f,y,v,C,g,b,R,S,E=Array(),w=7,k=12,F=17,L=22,B=5,T=9,A=14,V=20,x=4,q=11,M=16,N=23,D=6,H=10,z=15,I=21;for(t=m(t),E=u(t),g=1732584193,b=4023233417,R=2562383102,S=271733878,p=0;p<E.length;p+=16)f=g,y=b,v=R,C=S,g=r(g,b,R,S,E[p+0],w,3614090360),S=r(S,g,b,R,E[p+1],k,3905402710),R=r(R,S,g,b,E[p+2],F,606105819),b=r(b,R,S,g,E[p+3],L,3250441966),g=r(g,b,R,S,E[p+4],w,4118548399),S=r(S,g,b,R,E[p+5],k,1200080426),R=r(R,S,g,b,E[p+6],F,2821735955),b=r(b,R,S,g,E[p+7],L,4249261313),g=r(g,b,R,S,E[p+8],w,1770035416),S=r(S,g,b,R,E[p+9],k,2336552879),R=r(R,S,g,b,E[p+10],F,4294925233),b=r(b,R,S,g,E[p+11],L,2304563134),g=r(g,b,R,S,E[p+12],w,1804603682),S=r(S,g,b,R,E[p+13],k,4254626195),R=r(R,S,g,b,E[p+14],F,2792965006),b=r(b,R,S,g,E[p+15],L,1236535329),g=h(g,b,R,S,E[p+1],B,4129170786),S=h(S,g,b,R,E[p+6],T,3225465664),R=h(R,S,g,b,E[p+11],A,643717713),b=h(b,R,S,g,E[p+0],V,3921069994),g=h(g,b,R,S,E[p+5],B,3593408605),S=h(S,g,b,R,E[p+10],T,38016083),R=h(R,S,g,b,E[p+15],A,3634488961),b=h(b,R,S,g,E[p+4],V,3889429448),g=h(g,b,R,S,E[p+9],B,568446438),S=h(S,g,b,R,E[p+14],T,3275163606),R=h(R,S,g,b,E[p+3],A,4107603335),b=h(b,R,S,g,E[p+8],V,1163531501),g=h(g,b,R,S,E[p+13],B,2850285829),S=h(S,g,b,R,E[p+2],T,4243563512),R=h(R,S,g,b,E[p+7],A,1735328473),b=h(b,R,S,g,E[p+12],V,2368359562),g=c(g,b,R,S,E[p+5],x,4294588738),S=c(S,g,b,R,E[p+8],q,2272392833),R=c(R,S,g,b,E[p+11],M,1839030562),b=c(b,R,S,g,E[p+14],N,4259657740),g=c(g,b,R,S,E[p+1],x,2763975236),S=c(S,g,b,R,E[p+4],q,1272893353),R=c(R,S,g,b,E[p+7],M,4139469664),b=c(b,R,S,g,E[p+10],N,3200236656),g=c(g,b,R,S,E[p+13],x,681279174),S=c(S,g,b,R,E[p+0],q,3936430074),R=c(R,S,g,b,E[p+3],M,3572445317),b=c(b,R,S,g,E[p+6],N,76029189),g=c(g,b,R,S,E[p+9],x,3654602809),S=c(S,g,b,R,E[p+12],q,3873151461),R=c(R,S,g,b,E[p+15],M,530742520),b=c(b,R,S,g,E[p+2],N,3299628645),g=l(g,b,R,S,E[p+0],D,4096336452),S=l(S,g,b,R,E[p+7],H,1126891415),R=l(R,S,g,b,E[p+14],z,2878612391),b=l(b,R,S,g,E[p+5],I,4237533241),g=l(g,b,R,S,E[p+12],D,1700485571),S=l(S,g,b,R,E[p+3],H,2399980690),R=l(R,S,g,b,E[p+10],z,4293915773),b=l(b,R,S,g,E[p+1],I,2240044497),g=l(g,b,R,S,E[p+8],D,1873313359),S=l(S,g,b,R,E[p+15],H,4264355552),R=l(R,S,g,b,E[p+6],z,2734768916),b=l(b,R,S,g,E[p+13],I,1309151649),g=l(g,b,R,S,E[p+4],D,4149444226),S=l(S,g,b,R,E[p+11],H,3174756917),R=l(R,S,g,b,E[p+2],z,718787259),b=l(b,R,S,g,E[p+9],I,3951481745),g=n(g,f),b=n(b,y),R=n(R,v),S=n(S,C);var K=d(g)+d(b)+d(R)+d(S);return K.toLowerCase()};return t.prototype.send=function(){try{this.key=votesRef.push(this).key,ga("send","event",{eventCategory:"Voto",eventAction:this.match,eventLabel:this.candidate,eventValue:1})}catch(t){}},t}(),VotingBox=function(){function t(t,e){var n=this;this.element=t,this.base=e,this.current=!1,this.match=!1,this.onCurrentValueChange=function(t){n.current=t.val(),n.match&&n.match.destroy(),n.current&&(n.match=new Match(document.getElementById("match"),n.rootRef.ref("matches").child(n.current)))},this.element&&this.base&&this.init()}return t.prototype.ctrlDataRefs=function(){this.rootRef=this.base.database(),this.currentRef=this.rootRef.ref("current"),this.currentRef.on("value",this.onCurrentValueChange)},t.prototype.init=function(){this.ctrlDataRefs()},t}();