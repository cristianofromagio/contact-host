/*!
 * Mowe {ProjectName} Project v0.0.0 (http://letsmowe.org/)
 * Copyright 2013-2015 Mowe Developers
 * Licensed under MIT (https://github.com/mowekabanas/base/blob/master/LICENSE)
*/
var App=function(){function t(t,e){var n=this;this.element=t,this.base=e,this.votingBox=new VotingBox(document.getElementById("voting-box"),this.base),this.header=document.getElementById("ufs-app-header"),this.fullscreenCtrl=function(){n.requestFullScreen()},this.isFullscreen=!1,this.init()}return t.prototype.requestFullScreen=function(){this.isFullscreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),this.isFullscreen=!this.isFullscreen},t.prototype.init=function(){this.header.addEventListener("click",this.fullscreenCtrl)},t}(),Candidate=function(){function t(t,e,n){var i=this;this.element=t,this.candidateRef=e,this.voteButton=n,this.key=!1,this.onCandidateChange=function(t){var e=t.val();e&&(i.name=e.name,i.photoURL=e.photoURL,i.build(e))},this.element&&this.candidateRef&&this.init()}return t.prototype.build=function(t){try{this.element.innerHTML="",this.element.className="Candidate",this.background=document.createElement("div"),this.background.className="Candidate-background",this.element.appendChild(this.background),this.overlay=document.createElement("div"),this.overlay.className="Candidate-overlay",this.background.appendChild(this.overlay),this.title=document.createElement("div"),this.title.className="Candidate-title",this.titleSpan=document.createElement("span"),this.titleSpan.innerText=this.name,this.title.appendChild(this.titleSpan),this.background.appendChild(this.title),this.image=document.createElement("div"),this.image.className="Candidate-image",this.background.appendChild(this.image),this.image.style.backgroundImage="url("+this.photoURL+")",this.inner=document.createElement("div"),this.inner.className="Candidate-inner",this.element.appendChild(this.inner),this.voteButton.build(this),this.inner.appendChild(this.voteButton.element)}catch(e){}},t.prototype.destroy=function(){try{this.element.innerHeight="",self.candidateRef.off()}catch(t){}},t.prototype.ctrlDataRefs=function(){try{this.candidateRef.on("value",this.onCandidateChange)}catch(t){}},t.prototype.init=function(){this.ctrlDataRefs()},t}(),Match=function(){function t(t,e){var n=this;this.element=t,this.matchRef=e,this.key=!1,this.candidates=[],this.onMatchValueChange=function(t){n.key||(n.key=t.key);var e=t.val();e&&n.build(e)},this.element&&this.matchRef&&this.init()}return t.prototype.build=function(t){try{this.element.innerHTML="",this.destroyAllCandidates();for(var e=Object.keys(t.candidates),n=0;n<e.length;n++){var i=document.createElement("div"),s=firebase.database().ref("candidates/"+e[n]),a=new VoteButton(this.key,e[n]),o=new Candidate(i,s,a);o.classList="left",e.push(o),this.element.appendChild(o.element)}}catch(h){}},t.prototype.destroyAllCandidates=function(){for(var t=this.candidates.length;t--;)this.candidates[t].destroy();this.candidates=[]},t.prototype.destroy=function(){console.log("destruindo match");try{this.destroyAllCandidates(),this.element.innerHTML="",this.matchRef.off()}catch(t){}},t.prototype.ctrlDataRefs=function(){try{this.matchRef.on("value",this.onMatchValueChange)}catch(t){}},t.prototype.init=function(){this.ctrlDataRefs()},t}(),Modal=function(){function t(t){this.element=t,this.isShown=!1,this.element&&this.init()}return t.prototype.toggle=function(){this.isShown?this.hide():this.show()},t.prototype.show=function(){var t=this;this.isShown=!0,this.element.classList.add("is-active"),setTimeout(function(){t.element.classList.add("is-shown")},50)},t.prototype.hide=function(){var t=this;this.isShown=!1,this.element.classList.remove("is-shown"),setTimeout(function(){t.element.classList.remove("is-active")},600)},t.prototype.init=function(){this.element.classList.contains("is-active")&&(this.isShown=!0)},t}(),VoteButton=function(){function t(t,e){var n=this;this.matchKey=t,this.candidateKey=e,this.vote=function(t){n.delay&&clearTimeout(n.delay),modal.show(),n.delay=setTimeout(function(){var t=new Vote(n.matchKey,n.candidateKey);t.send(),setTimeout(function(){modal.hide()},2e3)},1e3)},this.onClick=function(){n.vote()},this.onTouchStart=function(){n.vote();try{window.navigator.vibrate(200),n.doBeep()}catch(t){}},this.init()}return t.prototype.delay=!1,t.prototype.audio=new Audio("../audio/music_marimba_chord.wav"),t.prototype.doBeep=function(){this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.audio.play())},t.prototype.build=function(t){this.element.innerHTML="",this.element.className="Button",this.pill=document.createElement("span"),this.pill.className="Button-pill",this.element.appendChild(this.pill),this.pillSpan=document.createElement("span"),this.pillSpan.innerText="Votar!",this.pill.appendChild(this.pillSpan),this.label=document.createElement("span"),this.label.className="Button-label",this.element.appendChild(this.label),this.labelSpan=document.createElement("span"),this.labelSpan.innerText=t.name,this.label.appendChild(this.labelSpan)},t.prototype.init=function(){this.element=document.createElement("button");try{this.element.addEventListener("click",this.onClick,!1),this.element.addEventListener("touchstart",this.onTouchStart,!1)}catch(t){}},t}(),Vote=function(){function t(t,e){this.match=t,this.candidate=e,this.timestamp=Date.now(),this.userAgent=window.navigator.userAgent,this.key=null}return t.prototype.send=function(){try{this.key=votesRef.push(this).key,console.log(this.key),ga("send","event",{eventCategory:"Voto",eventAction:this.match,eventLabel:this.candidate,eventValue:1})}catch(t){}},t}(),VotingBox=function(){function t(t,e){var n=this;this.element=t,this.base=e,this.current=!1,this.match=!1,this.onCurrentValueChange=function(t){var e=t.val();e&&(n.current=e,n.match&&n.match.destroy(),n.match=new Match(document.getElementById("match"),n.rootRef.ref("matches").child(e)))},this.element&&this.base&&this.init()}return t.prototype.ctrlDataRefs=function(){this.rootRef=this.base.database(),this.currentRef=this.rootRef.ref("current"),this.currentRef.on("value",this.onCurrentValueChange)},t.prototype.init=function(){this.ctrlDataRefs()},t}();